---
title: "Kolleg Europa - Network Analysis"
author: "Stefan Haussner"
date: "6 März 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(igraph)
library(igraphdata)
library(tidyverse)
```

# Exkurs: Hollywood als Affiliationsnetzwerk

The data file hwd in the UseNetR package contains a larger and more interesting
affiliation network that can be explored using these techniques. Hollywood actors
are a good example of an affiliation network, actors are connected to one another
through the movies in which they appear together. The hwd dataset is an igraph
bipartite graph object. The data are originally from IMDB (www.imdb.com).
The dataset contains the ten most popular movies (as judged by IMBD users) for each year from 1999 to 2014, and the first ten actors listed on each movie’s IMDB
page. In addition to the movie and actor names, each movie has the year of its release, its IMDB user rating, and the MPAA movie rating (i.e., G, PG, PG-13, and R)
stored as a node characteristic.



## Daten einlesen
```{r}
load("../data/hwd.rda")

hwd

V(hwd)$name[1:10]
V(hwd)$IMDBrating[1:10]

```

1365 nodes und 1600 ties. Bei 160 Movies und 1205 Actors.

## erster Blick ins Netzwerk (oder Untergruppen davon)

Vorteil des igraph-packages. Kann "grafische" Informationen direkt im Netzwerk-Objekt selbst speichern.

```{r}
V(hwd)$shape <- ifelse(V(hwd)$type==TRUE,
                      "square","circle")

V(hwd)$shape[1:10]
V(hwd)$shape[155:165]

V(hwd)$color <- ifelse(V(hwd)$type==TRUE,
"red","lightblue")
```

For the first plot, we will look at a subset of Martin Scorsese movies that were
released in the past 15 years. This example also illustrates how to create a subgraph by extracting only the edges that are incident to vertices with certain properties (in this case the name matches one of the three listed Scorsese movies). The key here is the inc special function of the E() edge iterator. The inc function takes a vertex sequence as an argument, and returns the incident edges. In this case, we are extracting all of the edges that are incident to the three Scorsese movies. For more information see the igraph help entry on iterators, which can be found with help(E). The resulting graphic highlights the special role of Leonardo DiCaprio in these Scorsese movies, being the only actor to star in all three.

```{r}
movie_selection <- c("The Wolf of Wall Street", "Gangs of New York","The Departed")

hwd_leo <- subgraph.edges(hwd, E(hwd)[inc(V(hwd)[name %in% movie_selection])])
plot(hwd_leo, layout = layout_with_kk)
```

What can be learned from the entire Hollywood network? Most network descriptive
statistics can be applied to affiliation networks, but they often need to be adjusted
either in how they are constructed or how they are interpreted. For example,
the overall density of the affiliation network can be easily calculated, but it is not
very meaningful given how the network data were collected (every actor by definition
is connected to a movie) and that there can be no ties among either the movie
nodes or among the actor nodes.

```{r}
graph.density(hwd)
```

Instead, node degree may be more informative, at least for actors. (In this dataset,
every movie has the same degree=10). The degree function allows specification
of which vertices to include, and that is used to select only the actors (for which the node characteristic type is FALSE).

```{r}
table(degree(hwd,v=V(hwd)[type==FALSE]))
mean(degree(hwd,v=V(hwd)[type==FALSE]))
```

This shows that the vast majority of actors only appeared in one movie, but there
were 15 actors who each starred in five or more movies since 1999. Across all the
actors, they starred in an average of 1.3 movies. This information can then be used
to identify the busiest actors of the past decade and a half. They owe a lot of thanks to Harry Potter and Batman!

```{r}
V(hwd)$deg <- degree(hwd)
V(hwd)[type==FALSE & deg > 4]$name
```


```{r}
busy_actor <- data.frame(cbind(
  Actor = V(hwd)[type==FALSE & deg > 4]$name,
  Movies = V(hwd)[type==FALSE & deg > 4]$deg)) %>% 
  as_tibble()

busy_actor %>% 
  arrange(desc(Movies))
```



![](https://media.giphy.com/media/26BRzozg4TCBXv6QU/giphy.gif)

![](https://media.giphy.com/media/uN5UYT8VnQ5UI/giphy.gif)

Hier könnte man jetzt noch einiges mehr an Quatsch machen. Das bringt uns in unserem Beispiel aber nicht weiter und nutzt eigentlich auch nicht wirklich die Möglichkeiten eines bipartiten Netzwerks.

## Analysis of the Actor and Movie Projections

Following the same procedures as presented in Sect. 9.2.4, the two projections of
the Hollywood affiliation network can be created and analyzed. This will produce
an actor network where actors have ties if they starred together in the same movie,
and a movie network where the movies are connected if they shared the same actors.
The actor projection will thus have 1,205 nodes, and the movie projection network
will have 160 nodes.

bipartite.projection funktioniert ohne weiteres Argument, wenn igraph-Objekt ein "type"-Attribut hat. Kann man sonst über Argument ändern.

```{r}
hwd_pr <- bipartite.projection(hwd)
hwd_act <- hwd_pr$proj1
hwd_mov <- hwd_pr$proj2
hwd_act
hwd_mov
```

In this figure, the entire movie network is presented, with node size based on the
IMDBrating, so that more popular movies have larger nodes (Fig. 9.6).

```{r}
plot(hwd_mov,
     vertex.color="red",
     vertex.shape="circle",
     vertex.size=(V(hwd_mov)$IMDBrating)-3,
     vertex.label=NA)
```

Some basic network descriptives provide more information about the Hollywood
movie network. Although there are some isolated movies (i.e., movies that did not
share actors with any of the other movies), most (148) of the movies form a large
connected component.

```{r}
graph.density(hwd_mov)

no.clusters(hwd_mov)

clusters(hwd_mov)$csize

table(E(hwd_mov)$weight)
```

The complete movie network can be filtered to examine the single large connected
component. In the next figure the edge width has been set to equal the square
root of weight edge attribute. This results in the ties being thicker for movies that share more actors between them (Fig. 9.7).

```{r}
hwd_mov2 <- induced.subgraph(hwd_mov,
                             vids=clusters(hwd_mov)$membership==1)
```

```{r}
plot(hwd_mov2,
     vertex.color="red",
     edge.width=sqrt(E(hwd_mov)$weight),
     vertex.shape="circle",
     vertex.size=(V(hwd_mov2)$IMDBrating)-3,
     vertex.label=NA)
```

The previous figure is still large and the relatively high density makes it somewhat
challenging to interpret any interesting structural features. To help with that,
we can identify the higher density cores of the graph, and use that to ‘zoom in’ on
the more interconnected part of the network. (See Chap. 8 for more information.)
This network is small enough that we can add node labels to help with the interpretation.
This helps us see that the most tightly connected sections of the network correspond to popular movie series, in particular Harry Potter, Batman, Star Wars,
and The Hobbit. This makes sense because movies in a series will naturally share
many or most of the same actors (Fig. 9.8).

```{r}
table(graph.coreness(hwd_mov2))
```

```{r}
hwd_mov3 <- induced.subgraph(hwd_mov2, 
                           vids=graph.coreness(hwd_mov2)>5)
hwd_mov3
unique(V(hwd_mov3)$name)
```

```{r}
plot(hwd_mov3,
     vertex.color="red",
     vertex.shape="circle",
     edge.width=sqrt(E(hwd_mov)$weight),
     vertex.label.cex=0.7,vertex.label.color="darkgreen",
     vertex.label.dist=0.3,
     vertex.size=(V(hwd_mov3)$IMDBrating)-3)
```



